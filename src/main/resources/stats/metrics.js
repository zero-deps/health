var Nodes=function(){var Nodes=React.createClass({displayName:"Nodes",parseData:function(rawData){var list=[].concat(rawData);var data=list.map(function(rawData){var arr=rawData.split('::');var obj={name:arr[0],node:arr[1],param:arr[2],time:arr[3],value:arr[4]};return obj;});return data;},packData:function(newData,initData){newData.forEach(function(obj){initData[obj.name]=initData[obj.name]||{};initData[obj.name][obj.node]=initData[obj.name][obj.node]||{};initData[obj.name][obj.node]["param"]=initData[obj.name][obj.node]["param"]||{};initData[obj.name][obj.node]["param"][obj.param]=obj.value;initData[obj.name][obj.node]["time"]=obj.time;});return {data:initData,activeName:this.state.activeName};},getInitialState:function(){return {data:{},activeName:null,nodeDetails:null};},componentDidMount:function(){this.props.handlers.metric=function(newDataRaw){if(this.isMounted()){var state=this.packData(this.parseData(newDataRaw),this.state.data);this.setState(state);}}.bind(this);},handleChooseTab:function(tab){this.setState({activeName:tab.props.name});},handleChooseRow:function(node){this.setState({nodeDetails:node});},handleRemoveRow:function(node){var ws=this.props.ws;var data=this.state.data;var name=this.state.activeName; // Remove on server
var params=Object.keys(data[name][node]["param"]);params.forEach(function(param){ws.send(name+"::"+node+"::"+param);}); // Remove on client
delete data[name][node];this.setState({data:data});},render:function(){var data=this.state.data;var names=Object.keys(data).sort();var el;if(names.length===0)el=React.createElement("div",{className:"alert alert-info"},"Please wait...");else {var activeName=this.state.activeName;if(names.indexOf(activeName)==-1)activeName=names[0];el=React.createElement("div",{className:"row"},React.createElement("div",{className:"col-sm-6 col-md-5 col-lg-4"},React.createElement(Tabs,{names:names,active:activeName,onChoose:this.handleChooseTab}),React.createElement(Table,{nameData:data[activeName],onRemoveRow:this.handleRemoveRow,onChooseRow:this.handleChooseRow})),(() => {var nodeDetails=this.state.nodeDetails;if(nodeDetails!==null)return React.createElement("div",{className:"col-sm-6 col-md-5 col-lg-4"},React.createElement("h3",null,activeName,"@",nodeDetails),React.createElement("h4",null,"Metrics"),React.createElement(Metrics,{data:data[activeName][nodeDetails]['param']}));})());}return React.createElement("div",{className:"col-xs-12"},React.createElement("h1",null,"Nodes"),el);}});var Tabs=React.createClass({displayName:"Tabs",render:function(){var tabs=this.props.names.map(function(name,i){var active=name===this.props.active;return React.createElement(Tab,{name:name,active:active,onChoose:this.props.onChoose,key:i});}.bind(this));return React.createElement("ul",{className:"nav nav-pills"},tabs);}});var Tab=React.createClass({displayName:"Tab",handleChoose:function(){this.props.onChoose(this);},render:function(){var className=this.props.active?"active":"";return React.createElement("li",{role:"presentation",className:className},React.createElement("a",{href:"#",onClick:this.handleChoose},this.props.name));}});var Table=React.createClass({displayName:"Table",render:function(){var nameData=this.props.nameData;var rows=Object.keys(nameData).map(function(node,i){return React.createElement(Row,{node:node,nodeData:nameData[node],onRemove:this.props.onRemoveRow,onChoose:this.props.onChooseRow,key:i});}.bind(this));return React.createElement("div",{className:"table-responsive",style:{marginTop:'10px'}},React.createElement("table",{className:"table"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,"Node"),React.createElement("th",{style:{width:'1px'}},"Status"),React.createElement("th",{style:{width:'1px'}}))),React.createElement("tbody",null,rows)));}});var Row=React.createClass({displayName:"Row",componentDidMount:function(){this.timer=setInterval(this.tick,1000);},componentWillUnmount:function(){clearInterval(this.timer);},tick:function(){this.forceUpdate();},handleChoose:function(){this.props.onChoose(this.props.node);},handleRemove:function(){this.props.onRemove(this.props.node);},render:function(){var elapsed=Math.floor((new Date()-this.props.nodeData["time"])/1000);return React.createElement("tr",{className:elapsed<3?"success":"danger",style:{cursor:'pointer'},onClick:this.handleChoose},React.createElement("td",null,this.props.node),React.createElement(LastUpdatedCell,{elapsed:elapsed}),React.createElement(RemoveCell,{onRemove:this.handleRemove}));}});var LastUpdatedCell=React.createClass({displayName:"LastUpdatedCell",render:function(){var elapsed=this.props.elapsed;var text=elapsed<3?"OK":elapsed.toUnits()+" ago";return React.createElement("td",null,text);}});var RemoveCell=React.createClass({displayName:"RemoveCell",handleRemove:function(){this.props.onRemove();},render:function(){return React.createElement("td",null,React.createElement("span",{style:{cursor:'pointer'},onClick:this.handleRemove},React.createElement("span",{className:"glyphicon glyphicon-remove-circle","aria-hidden":"true"})),React.createElement("span",{className:"sr-only"},"Remove"));}});var Metrics=React.createClass({displayName:"Metrics",render:function(){var data=this.props.data;return React.createElement("ul",{className:"list-group"},React.createElement("li",{className:"list-group-item"},React.createElement("span",{className:"badge"},data['CPU']?data['CPU']:'N/A'),"CPU"),React.createElement("li",{className:"list-group-item"},React.createElement("span",{className:"badge"},data['Heap']?data['Heap']:'N/A'),"Heap"));}});return Nodes;}();